{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "articles.explore_title" %} - DevSpace{% endblock %}

{% block page_title %}{% trans "articles.explore_title" %}{% endblock %}
{% block page_subtitle %}{% trans "articles.explore_subtitle" %}{% endblock %}

{% block content %}
    <!-- Messages de succ√®s -->
    {% if messages %}
        <div class="mb-8">
            {% for message in messages %}
                <div class="transform transition-all duration-500 ease-in-out animate-slideDown notification-alert" role="alert">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-4 shadow-sm relative overflow-hidden">
                        <div class="absolute inset-y-0 left-0 w-1 bg-gradient-to-b from-green-400 to-emerald-500"></div>
                        <div class="flex items-center ml-3">
                            <div class="flex-shrink-0">
                                <div class="p-1 bg-green-100 rounded-full">
                                    <svg class="h-5 w-5 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="text-sm font-medium text-green-800">{{ message }}</p>
                            </div>
                            <button type="button" class="ml-4 inline-flex text-green-400 hover:text-green-600 transition-colors" onclick="dismissNotification(this)">
                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Bandeau Explorer -->
    <div class="relative bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-600 rounded-3xl overflow-hidden mb-12 shadow-2xl">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
        
        <!-- Motif d√©coratif -->
        <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -mb-10 -ml-10 w-60 h-60 bg-white opacity-10 rounded-full blur-3xl"></div>
        
        <div class="relative px-8 py-12 sm:px-12 sm:py-16">
            <div class="max-w-4xl">
                <h1 class="text-3xl sm:text-4xl font-bold text-white mb-4 leading-tight">
                    {% trans "articles.explore_banner_title" %}
                </h1>
                <p class="text-lg text-white/90 mb-6 max-w-2xl">
                    {% trans "articles.explore_banner_subtitle" %}
                </p>
                <div class="flex items-center gap-4 text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span class="text-sm font-medium">{% trans "articles.explore_banner_info" %}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Barre de recherche et filtres -->
    <div class="mb-8">
        <div class="theme-card rounded-2xl shadow-lg p-6 border">
            <form method="GET" class="space-y-4">
                <!-- Ligne principale: Recherche et Cat√©gorie -->
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Recherche -->
                    <div class="flex-1">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input type="text" 
                                   name="query" 
                                   value="{{ request.GET.query }}"
                                   placeholder="{% trans 'articles.search_placeholder' %}" 
                                   class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-red-500 focus:border-red-500 sm:text-sm theme-card">
                        </div>
                    </div>
                    
                    <!-- Filtre par cat√©gorie -->
                    <div class="md:w-48">
                        <select name="category" class="block w-full py-2 px-3 border border-gray-300 theme-card rounded-xl shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                            <option value="">{% trans "articles.all_categories" %}</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                                    {{ category.nom }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <!-- Filtre par tags -->
                <div>
                    <label class="block text-sm font-medium theme-text-secondary mb-2">{% trans "Tags" %}</label>
                    <div class="flex flex-wrap gap-2">
                        {% for tag in tags %}
                            <label class="inline-flex items-center">
                                <input type="checkbox" 
                                       name="tag" 
                                       value="{{ tag.id }}" 
                                       {% if tag.id|stringformat:"s" in request.GET.tag %}checked{% endif %}
                                       class="rounded border-gray-300 text-red-600 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50">
                                <span class="ml-2 text-sm theme-text-secondary">{{ tag.nom }}</span>
                            </label>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Boutons -->
                <div class="flex gap-2">
                    <button type="submit" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-500 to-orange-500 text-white font-medium rounded-xl hover:from-red-600 hover:to-orange-600 transition-all duration-200 shadow-sm hover:shadow-md">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        {% trans "articles.search" %}
                    </button>
                    {% if request.GET.query or request.GET.category or request.GET.tag %}
                    <a href="{% url 'posts:search' %}" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        {% trans "articles.clear" %}
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    {% if articles %}
        <!-- Section des articles -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">
                        {% if search_query %}
                            {% blocktrans %}Results for "{{ search_query }}"{% endblocktrans %}
                        {% elif category_filter %}
                            {% trans "articles.articles_in_category" %}
                        {% else %}
                            {% trans "articles.all_articles" %}
                        {% endif %}
                    </h2>
                    <p class="text-gray-600">
                        {% if search_query or category_filter %}
                            {% blocktrans count count=articles.count %}{{ count }} result found{% plural %}{{ count }} results found{% endblocktrans %}
                        {% else %}
                            {% trans "articles.browse_collection" %}
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
            {% for article in articles %}
                <article class="group relative bg-white/95 backdrop-blur-sm rounded-2xl overflow-visible shadow-lg hover:shadow-2xl hover-lift transition-all duration-500 border border-white/20 fade-in-up stagger-animation">
                    <!-- Image de couverture (gradient si pas d'image) -->
                    <div class="h-48 relative overflow-hidden rounded-t-2xl">
                        {% if article.image %}
                            <img src="{{ article.image.url }}" alt="{{ article.titre }}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-black/30"></div>
                        {% else %}
                            <div class="h-full bg-gradient-to-br from-red-400 via-[#da3e44] to-orange-500 animate-gradient">
                                <div class="absolute inset-0 bg-black/20"></div>
                                <!-- Particules flottantes -->
                                <div class="absolute top-4 left-4 w-2 h-2 bg-white/40 rounded-full floating-animation"></div>
                                <div class="absolute top-8 right-8 w-1 h-1 bg-white/60 rounded-full floating-animation" style="animation-delay: 1s;"></div>
                                <div class="absolute bottom-6 left-1/3 w-1.5 h-1.5 bg-white/30 rounded-full floating-animation" style="animation-delay: 2s;"></div>
                            </div>
                        {% endif %}
                        <div class="absolute bottom-0 left-0 right-0 p-6">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/90 text-gray-800 backdrop-blur-sm">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                                </svg>
                                {{ article.date_creation|date:"j F Y" }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Titre -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2 group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-purple-600 group-hover:to-blue-600 group-hover:bg-clip-text transition-all duration-500 ease-in-out">
                            <a href="{% url 'posts:article_detail' article.id %}" class="hover:text-purple-600 transition-colors">
                                {{ article.titre }}
                            </a>
                        </h3>
                        
                        <!-- Auteur avec avatar -->
                        <div class="flex items-center mb-4">
                            <div class="relative">
                                <div class="h-10 w-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold text-sm shadow-md group-hover:shadow-lg group-hover:scale-110 transition-all duration-300 animate-gradient">
                                    {{ article.get_author_display_name|slice:":1"|upper }}
                                </div>
                                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-semibold text-gray-900">{{ article.get_author_display_name }}</p>
                                <p class="text-xs text-gray-500">{% trans "articles.verified_author" %}</p>
                            </div>
                        </div>
                        
                        <!-- Contenu -->
                        <p class="text-gray-600 mb-4 line-clamp-3 leading-relaxed">
                            {{ article.contenu|truncatewords:20 }}
                        </p>
                        
                        <!-- R√©actions et interactions -->
                        <div class="mb-4 space-y-3">
                            <!-- Statistiques de r√©actions existantes -->
                            {% if article.reaction_stats %}
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-1">
                                        {% for reaction_type, reaction_data in article.reaction_stats.items %}
                                            <div class="flex items-center bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 border border-blue-100 rounded-lg px-3 py-1 transition-all duration-200 cursor-pointer group shadow-sm hover:shadow-md" 
                                                 onclick="window.location.href='{% url 'posts:article_detail' article.id %}#reactions'"
                                                 title="Voir toutes les r√©actions">
                                                <span class="text-base mr-1">{{ reaction_data.emoji }}</span>
                                                <span class="text-sm font-semibold text-blue-600 group-hover:text-blue-700">{{ reaction_data.count }}</span>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% if article.total_reactions %}
                                        <span class="text-xs text-gray-500 font-medium">{% blocktrans count count=article.total_reactions %}{{ count }} reaction{% plural %}{{ count }} reactions{% endblocktrans %}</span>
                                    {% endif %}
                                </div>
                            {% endif %}
                            
                            <!-- Barre de r√©actions interactive -->
                            <div class="flex items-center justify-between bg-gray-50 rounded-xl p-3 border border-gray-100 relative overflow-visible">
                                <div class="flex items-center space-x-2">
                                    <button onclick="quickReaction({{ article.id }}, 'like', this, event)" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                            class="quick-reaction-btn flex items-center justify-center w-8 h-8 hover:bg-blue-100 hover:scale-110 rounded-full transition-all duration-200 group border {% if 'like' in article.user_reaction_types %}border-blue-300 bg-blue-100{% else %}border-transparent{% endif %} hover:border-blue-200" 
                                            title="{% trans 'articles.like' %}">
                                        <span class="text-lg transform group-hover:rotate-12 transition-transform">üëç</span>
                                    </button>
                                    <button onclick="quickReaction({{ article.id }}, 'love', this, event)" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                            class="quick-reaction-btn flex items-center justify-center w-8 h-8 hover:bg-red-100 hover:scale-110 rounded-full transition-all duration-200 group border {% if 'love' in article.user_reaction_types %}border-red-300 bg-red-100{% else %}border-transparent{% endif %} hover:border-red-200" 
                                            title="{% trans 'articles.love' %}">
                                        <span class="text-lg transform group-hover:scale-125 transition-transform">‚ù§Ô∏è</span>
                                    </button>
                                    <button onclick="quickReaction({{ article.id }}, 'laugh', this, event)" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                            class="quick-reaction-btn flex items-center justify-center w-8 h-8 hover:bg-yellow-100 hover:scale-110 rounded-full transition-all duration-200 group border {% if 'laugh' in article.user_reaction_types %}border-yellow-300 bg-yellow-100{% else %}border-transparent{% endif %} hover:border-yellow-200" 
                                            title="{% trans 'articles.laugh' %}">
                                        <span class="text-lg transform group-hover:rotate-12 transition-transform">üòÇ</span>
                                    </button>
                                    <button onclick="quickReaction({{ article.id }}, 'wow', this, event)" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                            class="quick-reaction-btn flex items-center justify-center w-8 h-8 hover:bg-green-100 hover:scale-110 rounded-full transition-all duration-200 group border {% if 'wow' in article.user_reaction_types %}border-green-300 bg-green-100{% else %}border-transparent{% endif %} hover:border-green-200" 
                                            title="{% trans 'articles.wow' %}">
                                        <span class="text-lg transform group-hover:scale-125 transition-transform">üòÆ</span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center space-x-3">
                                    <!-- Compteur de commentaires -->
                                    {% if article.commentaires.count > 0 %}
                                        <a href="{% url 'posts:article_detail' article.id %}#commentaires" 
                                           class="flex items-center space-x-1 text-gray-500 hover:text-blue-600 transition-colors group">
                                            <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="text-sm font-medium">{{ article.commentaires.count }}</span>
                                        </a>
                                    {% endif %}
                                    
                                    <!-- Menu d√©roulant pour plus de r√©actions -->
                                    <div class="relative">
                                        <button onclick="toggleReactionMenu({{ article.id }})" 
                                                class="px-3 py-1.5 text-xs font-semibold text-gray-500 bg-gray-50 hover:bg-blue-500 hover:text-white rounded-full border border-gray-200 hover:border-blue-500 shadow-sm flex items-center space-x-1.5"
                                                id="reactions-menu-btn-{{ article.id }}"
                                                style="visibility: visible; display: flex;">
                                            <span>{% trans "articles.more" %}</span>
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                        
                                        <!-- Menu d√©roulant -->
                                        <div id="reactions-menu-{{ article.id }}" 
                                             class="absolute right-0 top-full mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-200/50 opacity-0 scale-95 transform origin-top-right transition-all duration-200 pointer-events-none"
                                             style="z-index: 99999;">
                                            <div class="p-3">
                                                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3">{% trans "articles.all_reactions" %}</h4>
                                                <div class="grid grid-cols-3 gap-2">
                                                    <button onclick="quickReaction({{ article.id }}, 'like', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-blue-50 rounded-lg transition-colors group {% if 'like' in article.user_reaction_types %}bg-blue-100 border border-blue-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">üëç</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.like" %}</span>
                                                    </button>
                                                    <button onclick="quickReaction({{ article.id }}, 'love', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-red-50 rounded-lg transition-colors group {% if 'love' in article.user_reaction_types %}bg-red-100 border border-red-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">‚ù§Ô∏è</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.love" %}</span>
                                                    </button>
                                                    <button onclick="quickReaction({{ article.id }}, 'laugh', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-yellow-50 rounded-lg transition-colors group {% if 'laugh' in article.user_reaction_types %}bg-yellow-100 border border-yellow-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">üòÇ</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.laugh" %}</span>
                                                    </button>
                                                    <button onclick="quickReaction({{ article.id }}, 'wow', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-green-50 rounded-lg transition-colors group {% if 'wow' in article.user_reaction_types %}bg-green-100 border border-green-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">üòÆ</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.wow" %}</span>
                                                    </button>
                                                    <button onclick="quickReaction({{ article.id }}, 'sad', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-blue-50 rounded-lg transition-colors group {% if 'sad' in article.user_reaction_types %}bg-blue-100 border border-blue-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">üò¢</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.sad" %}</span>
                                                    </button>
                                                    <button onclick="quickReaction({{ article.id }}, 'angry', this, event); closeReactionMenu({{ article.id }})" data-reaction-url="{% url 'posts:add_reaction' article.id %}" 
                                                            class="reaction-menu-btn flex flex-col items-center p-2 hover:bg-orange-50 rounded-lg transition-colors group {% if 'angry' in article.user_reaction_types %}bg-orange-100 border border-orange-300{% endif %}"
                                                            title="Cliquez pour activer/d√©sactiver cette r√©action">
                                                        <span class="text-xl mb-1 group-hover:scale-110 transition-transform">üò†</span>
                                                        <span class="text-xs text-gray-600 font-medium">{% trans "articles.angry" %}</span>
                                                    </button>
                                                </div>
                                                <div class="mt-3 p-2 bg-green-50 rounded-lg">
                                                    <p class="text-xs text-green-700 text-center">
                                                        üéâ <strong>{% trans "articles.new" %}:</strong> {% trans "articles.multiple_reactions_info" %}
                                                    </p>
                                                </div>
                                                <div class="border-t border-gray-100 mt-3 pt-3">
                                                    <a href="{% url 'posts:article_detail' article.id %}#reactions" 
                                                       class="flex items-center justify-center w-full py-2 text-xs text-gray-500 hover:text-blue-600 transition-colors font-medium">
                                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                                        </svg>
                                                        {% trans "articles.view_full_article" %}
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer avec stats -->
                        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"></path>
                                    </svg>
                                    {% blocktrans count words=article.contenu|wordcount %}{{ words }} word{% plural %}{{ words }} words{% endblocktrans %}
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                    </svg>
                                    {% trans "articles.read_time" %}
                                </span>
                            </div>
                            <a href="{% url 'posts:article_detail' article.id %}" class="text-purple-600 hover:text-purple-800 font-medium text-sm flex items-center group/btn">
                                {% trans "articles.read" %}
                                <svg class="w-4 h-4 ml-1 transform group-hover/btn:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <!-- √âtat vide am√©lior√© -->
        <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-100 to-pink-100 opacity-30 blur-3xl animate-gradient"></div>
            <div class="relative bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl overflow-hidden border border-white/20 hover-lift">
                <div class="px-8 py-16 sm:px-12 sm:py-20 text-center">
                    <div class="mx-auto w-32 h-32 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mb-8 floating-animation animate-gradient">
                        <svg class="w-16 h-16 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-900 mb-4">{% trans "articles.your_story_starts_here" %}</h3>
                    <p class="text-xl text-gray-600 mb-8 max-w-md mx-auto">
                        {% trans "articles.be_first_to_share" %}
                    </p>
                    {% if user.is_authenticated %}
                    <a href="{% url 'posts:ajouter_article' %}" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 pulse-glow animate-gradient">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        {% trans "articles.write_first_article" %}
                    </a>
                    {% else %}
                    <a href="{% url 'accounts:login' %}" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 pulse-glow animate-gradient">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 6a2 2 0 002 2h6a2 2 0 002-2v-1m-11 1a2 2 0 002 2h6a2 2 0 002-2M7 21h10a2 2 0 002-2V9a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        {% trans "articles.login_to_write" %}
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<style>
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-slideDown {
        animation: slideDown 0.5s ease-out;
    }
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .quick-reaction-success {
        animation: reactionPulse 0.6s ease-out;
    }
    @keyframes reactionPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.5); }
        100% { transform: scale(1); }
    }
    .quick-reaction-btn {
        position: relative;
        overflow: hidden;
    }
    .quick-reaction-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    .quick-reaction-btn:active::before {
        width: 300px;
        height: 300px;
    }
</style>

<script>
// Fonction pour fermer les notifications
function dismissNotification(button) {
    const notification = button.closest('.notification-alert');
    notification.style.opacity = '0';
    notification.style.transform = 'translateY(-20px)';
    setTimeout(() => {
        notification.remove();
    }, 300);
}

// Cr√©er une notification moderne et √©l√©gante
function createModernNotification(message, type = 'success') {
    const colors = {
        success: {
            bg: 'from-emerald-50 to-green-50',
            border: 'border-emerald-200',
            text: 'text-emerald-800',
            icon: 'text-emerald-600',
            iconBg: 'bg-emerald-100',
            accent: 'from-emerald-400 to-green-500'
        },
        error: {
            bg: 'from-red-50 to-pink-50',
            border: 'border-red-200',
            text: 'text-red-800',
            icon: 'text-red-600',
            iconBg: 'bg-red-100',
            accent: 'from-red-400 to-pink-500'
        }
    };
    
    const color = colors[type];
    
    const notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 z-50 transform translate-x-full opacity-0 transition-all duration-500 ease-out';
    notification.innerHTML = `
        <div class="bg-gradient-to-r ${color.bg} border ${color.border} rounded-2xl p-4 shadow-xl backdrop-blur-sm max-w-sm">
            <div class="absolute inset-y-0 left-0 w-1 bg-gradient-to-b ${color.accent}"></div>
            <div class="flex items-start ml-3">
                <div class="flex-shrink-0">
                    <div class="p-1.5 ${color.iconBg} rounded-full">
                        ${type === 'success' ? 
                            `<svg class="h-4 w-4 ${color.icon}" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>` :
                            `<svg class="h-4 w-4 ${color.icon}" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>`
                        }
                    </div>
                </div>
                <div class="ml-3 flex-1">
                    <p class="text-sm font-semibold ${color.text}">${message}</p>
                </div>
                <button type="button" class="ml-3 inline-flex ${color.icon} hover:opacity-75 transition-opacity" onclick="dismissModernNotification(this)">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animation d'entr√©e
    setTimeout(() => {
        notification.classList.remove('translate-x-full', 'opacity-0');
    }, 100);
    
    // Auto-suppression apr√®s 4 secondes
    setTimeout(() => {
        dismissModernNotification(notification.querySelector('button'));
    }, 4000);
    
    return notification;
}

function dismissModernNotification(button) {
    const notification = button.closest('.fixed');
    notification.classList.add('translate-x-full', 'opacity-0');
    setTimeout(() => {
        notification.remove();
    }, 500);
}

// Gestion du menu d√©roulant des r√©actions
function toggleReactionMenu(articleId) {
    try {
        console.log('toggleReactionMenu appel√© pour article ID:', articleId);
        const menu = document.getElementById(`reactions-menu-${articleId}`);
        const button = document.getElementById(`reactions-menu-btn-${articleId}`);
        
        console.log('Bouton trouv√©:', button);
        console.log('Menu trouv√©:', menu);
        
        if (!menu || !button) {
            console.error('Menu ou bouton introuvable pour article ID:', articleId);
            return;
        }
        
        const isVisible = !menu.classList.contains('opacity-0');
        
        // Fermer tous les autres menus
        document.querySelectorAll('[id^="reactions-menu-"]').forEach(otherMenu => {
            if (otherMenu.id !== `reactions-menu-${articleId}`) {
                otherMenu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                const otherButtonId = otherMenu.id.replace('reactions-menu-', 'reactions-menu-btn-');
                const otherButton = document.getElementById(otherButtonId);
                if (otherButton) {
                    const svg = otherButton.querySelector('svg');
                    if (svg) svg.classList.remove('rotate-180');
                }
            }
        });
        
        if (isVisible) {
            // Fermer le menu
            menu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
            const svg = button.querySelector('svg');
            if (svg) svg.classList.remove('rotate-180');
        } else {
            // Ouvrir le menu
            menu.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
            const svg = button.querySelector('svg');
            if (svg) svg.classList.add('rotate-180');
        }
    } catch (error) {
        console.error('Erreur dans toggleReactionMenu:', error);
    }
}

function closeReactionMenu(articleId) {
    const menu = document.getElementById(`reactions-menu-${articleId}`);
    const button = document.getElementById(`reactions-menu-btn-${articleId}`);
    menu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
    button.querySelector('svg').classList.remove('rotate-180');
}

// Fermer les menus en cliquant √† l'ext√©rieur
document.addEventListener('click', function(event) {
    // V√©rifier si le clic est en dehors de tous les menus et boutons de r√©action
    const clickedOnMenu = event.target.closest('[id^="reactions-menu-"]');
    const clickedOnButton = event.target.closest('[id^="reactions-menu-btn-"]');
    
    if (!clickedOnMenu && !clickedOnButton) {
        // Fermer tous les menus ouverts
        document.querySelectorAll('[id^="reactions-menu-"]').forEach(menu => {
            menu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
        });
        
        // Remettre tous les SVG √† l'√©tat normal
        document.querySelectorAll('[id^="reactions-menu-btn-"]').forEach(button => {
            const svg = button.querySelector('svg');
            if (svg) {
                svg.classList.remove('rotate-180');
            }
        });
    }
});

function quickReaction(articleId, reactionType, buttonElement, event) {
    // Emp√™cher la propagation pour √©viter de d√©clencher d'autres √©v√©nements
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }
    
    // V√©rifier si l'utilisateur est connect√©
    {% if not user.is_authenticated %}
    createModernNotification('{% trans "articles.login_required_to_react" %}', 'error');
    setTimeout(() => {
        window.location.href = '{% url "accounts:login" %}';
    }, 1500);
    return;
    {% endif %}
    // D√©sactiver temporairement tous les boutons de r√©action de cet article
    const articleCard = buttonElement.closest('article');
    const reactionBtns = articleCard.querySelectorAll('.quick-reaction-btn');
    reactionBtns.forEach(btn => {
        btn.disabled = true;
        btn.style.opacity = '0.6';
    });
    
    // R√©cup√©rer le token CSRF
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    const csrftoken = getCookie('csrftoken');
    
    // Cr√©er les donn√©es du formulaire
    const formData = new FormData();
    formData.append('reaction_type', reactionType);
    
    // Get the reaction URL from the button's data attribute
    const reactionUrl = buttonElement.getAttribute('data-reaction-url');
    
    fetch(reactionUrl, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'X-Requested-With': 'XMLHttpRequest',
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Animation de succ√®s sur le bouton cliqu√©
            const emojiSpan = buttonElement.querySelector('span');
            emojiSpan.classList.add('quick-reaction-success');
            setTimeout(() => {
                emojiSpan.classList.remove('quick-reaction-success');
            }, 600);
            
            // Messages selon l'action
            let message = '';
            switch(data.action) {
                case 'added':
                    message = '‚ú® R√©action ajout√©e !';
                    break;
                case 'removed':
                    message = 'üóëÔ∏è R√©action supprim√©e !';
                    break;
                default:
                    message = 'üéâ R√©action mise √† jour !';
            }
            createModernNotification(message, 'success');
            
            // Mettre √† jour l'apparence du bouton sans recharger
            if (data.action === 'added') {
                buttonElement.classList.add('border-blue-300', 'bg-blue-100');
                buttonElement.classList.remove('border-transparent');
            } else if (data.action === 'removed') {
                buttonElement.classList.remove('border-blue-300', 'bg-blue-100');
                buttonElement.classList.add('border-transparent');
            }
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        // Afficher une notification d'erreur moderne
        createModernNotification('Erreur lors de l\'ajout de la r√©action', 'error');
    })
    .finally(() => {
        // R√©activer les boutons
        reactionBtns.forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
        });
    });
}
</script>
{% endblock %}